<!DOCTYPE html>
<html>
<head>
	<title>ETL process to load and summarize the data on the Agency Performance Model</title>
</head>
<body>

<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<link href="{{ url_for('static', filename='css/custome.css') }}" rel="stylesheet">
<!------ Include the above in your HEAD tag ---------->

<div class="wrapper fadeInDown">
  <div id="formContent">
    <!-- Tabs Titles -->

    <!-- Icon -->
    <div class="fadeIn first">
      
    </div>

    <!-- Login Form -->
    <form id="formlogin" name="formlogin" onsubmit="return newRequest()" >
      <input type="text" id="login" class="fadeIn second" name="username" placeholder="username">
      <input type="password" id="password" class="fadeIn third" name="password" placeholder="password">
      <input type="submit" class="fadeIn fourth" value="Log In">
    </form>

    <!-- Remind Passowrd -->
    <div id="formFooter">
      <a class="underlineHover" href="#">Forgot Password?</a>
    </div>

  </div>
</div>

<script>

function newRequest () {

    console.log("NEW REQUEST");
    //const { authenticated } = this.state;
    const loginUser = {
        username: $("#login").val(),
        password: $("#password").val()
    }
    
    var form = new FormData(document.getElementById('formlogin'));
    console.log(form);
    fetch('/login', {
        method: 'post',
        body: form,
        }).then((response) => {
        if (response.statusText === "OK"){
            //resp = response.text();
            console.log(response);

            response.json().then(post => {
            localStorage.setItem('token', post.access_token);
            console.log(post);
            //return false;
            console.log("READED:"+localStorage.getItem('token'));
            /////////////////////////
            setCookie("name", post.message, 1);
           
            window.location.href = "/dashboard";
            })
        } else {
            alert ('Incorrect Login Credentials');
            return false;
        }
    })
     
    return false;
};


function setCookie(name, value, days) {
  var expires = "";
  if (days) {
    var date = new Date();
    date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
    expires = "; expires=" + date.toUTCString();
  }
  document.cookie = name + "=" + (value || "") + expires + "; path=/";
}


function redirect( token){

console.log("RED")
var dataValue = 1;
$.ajax({
            type : 'POST',
            //remove the .php from results.php.php
            url : "/partial",
            //Add the request header
            headers : {
                Authorization : 'Bearer ' + localStorage.getItem('token'),
            },
            
            //Add form data
            data : {keyName : dataValue},
            success : function(response) {
                console.log(JSON.stringify(response)+ "RESPONSE");
                return false;
            },
            error : function(response) {
               // var err = eval("(" + xhr.responseText + ")");
                console.log("err"+ response.text); 
                return false;                  
            }
        });
        
        return false; //End of Ajax
}  






</script>






</body>
</html>